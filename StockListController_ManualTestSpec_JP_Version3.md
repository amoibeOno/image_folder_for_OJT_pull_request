```markdown
# 手動検査仕様書（日本語）: StockListController （ブラウザでの確認向け）

対象:
- ファイル: DroneInventorySystem/src/main/java/com/digitalojt/web/controller/StockListController.java
- 対象画面: 在庫一覧 / 検索 / 在庫登録（表示・登録） / 在庫更新（表示・更新）
- 実行環境: ローカルまたは検査環境でアプリを起動済み（必要に応じてテスト用 DB に初期データ投入）

注意:
- 以下の URL はコード内で UrlConsts.<NAME> として定義されています。検査時は実際のパス（例: /stock/list など）を使用してください。
  - UrlConsts.STOCK_LIST
  - UrlConsts.STOCK_LIST_SEARCH
  - UrlConsts.STOCK_LIST_REGISTER
  - UrlConsts.STOCK_LIST_UPDATE

共通前提:
- Web アプリが起動していること（例: http://localhost:8080）
- テスターが利用するブラウザ（Chrome, Firefox など）
- 必要なら認証済みユーザでログインしておく（アプリに認証がある場合）
- テストに使うデータは事前に用意（下部にサンプルデータあり）

記号:
- 実際の URL は以下のように表記します： {STOCK_LIST_URL} は UrlConsts.STOCK_LIST に置換してください

----------------------------
総合チェック（事前確認）
- TC-00: アプリ起動 & ナビゲーション
  - 目的: 在庫一覧ページへアクセスできるか確認
  - 手順:
    1. ブラウザで {STOCK_LIST_URL} にアクセス
  - 期待結果:
    - ページが表示される（HTTP 200）
    - 在庫一覧のテーブルまたはリストが見える
    - 「カテゴリ」等の参照データが画面に表示される
  - 優先度: 高

----------------------------
一覧表示関連
- TC-01: 在庫一覧の表示（基本）
  - 目的: 一覧画面が正しくデータを表示すること
  - 前提: DB に 1 件以上の在庫データが存在する
  - 手順:
    1. {STOCK_LIST_URL} にアクセス
  - 期待結果:
    - 在庫行がテーブル/リストに表示される（品名、カテゴリ、拠点、数量など）
    - ページ上にカテゴリの選択肢（ドロップダウン等）が表示される
  - 確認箇所: 表示件名・数量・カテゴリ名が DB の値と一致するか
  - 優先度: 高

----------------------------
検索（GET: search）関連
- TC-02: 検索（正常） - 部品名で絞り込み
  - 目的: 部品名で絞り込みが機能すること
  - 手順:
    1. {STOCK_LIST_URL} 上の検索フォームで「部品名」に既知の値を入力（例: "DroneA"）
    2. 検索ボタンをクリック（または検索 URL にパラメータをつけて GET）
  - 期待結果:
    - 結果リストに入力した部品名を含む行のみが表示される
    - ModelAttributeContents.STOCK_ITEM_LIST に相当する表示が更新される
  - 優先度: 高

- TC-03: 検索（正常） - カテゴリで絞り込み
  - 目的: カテゴリ選択で絞り込みが機能すること
  - 手順:
    1. カテゴリを選択して検索実行
  - 期待結果:
    - 選択カテゴリに属する在庫のみ表示される
  - 優先度: 中

- TC-04: 検索（負のケース） - 数値フィールドに不正文字を入力
  - 目的: 数値変換処理（NumberFormatException -> null）によりエラーにならないこと
  - 手順:
    1. 数量欄（quantity）に "12x"、またはカテゴリ ID フィールドに "abc" を入力して検索
  - 期待結果:
    - バリデーション例外で画面遷移しない（bindingResult.hasErrors が発生しない限りは）
    - コントローラは不正な数値を null として扱い、検索を実行する（適切な結果または空一覧を表示）
    - もしフォームのアノテーションで数値形式を厳格にしている場合は、エラーメッセージが表示される（その場合は TC-05 を参照）
  - 優先度: 中
  - 注意: 実アプリのバリデーション定義により挙動が異なるため、期待結果はプロジェクト仕様に合わせる

- TC-05: 検索（バリデーションエラー）
  - 目的: バリデーションエラー発生時にエラーメッセージが表示されること
  - 手順:
    1. 検索フォームにバリデーション違反の入力（必須空、長すぎる文字列等）を入力して検索
  - 期待結果:
    - エラーメッセージ（ModelAttributeContents.ERROR_MSG 相当）がページに表示される
    - 検索結果領域は空または前回の状態（仕様に準ずる）
  - 優先度: 高

----------------------------
登録（GET / POST）関連
- TC-06: 登録画面 (GET) の表示
  - 目的: 登録画面でフォームと参照データが表示されること
  - 手順:
    1. {STOCK_LIST_REGISTER_URL} にアクセス（UrlConsts.STOCK_LIST_REGISTER）
  - 期待結果:
    - 空の登録フォーム（部品名、カテゴリ、拠点、数量、説明など）が表示される
    - 「カテゴリ」と「拠点」ドロップダウンが参照データで埋まっている
  - 優先度: 中

- TC-07: 登録（POST） - バリデーションエラー時
  - 目的: 入力不備時は登録せず、登録画面へリダイレクトしエラーメッセージがフラッシュされること
  - 手順:
    1. 登録フォームに不正な値（必須空など）を入力して送信
  - 期待結果:
    - ブラウザは "redirect:{STOCK_LIST_REGISTER}" にリダイレクトされる
    - リダイレクト後に画面上にエラーメッセージ（flashed ERROR_MSG）が表示される
    - DB にレコードが追加されていないことを確認する
  - 確認方法: DB（または一覧画面）で追加がないことを確認
  - 優先度: 高

- TC-08: 登録（POST） - 正常登録
  - 目的: 正常な入力で在庫が登録され一覧に戻ること
  - 前提: 重複チェックに引っかからない一意の部品名を使用
  - 手順:
    1. 登録フォームに有効なデータを入力（例: partName="NewPart", categoryId=1, centerId=1, quantity=10）
    2. 送信
  - 期待結果:
    - service.stockDuplicationCheck が呼ばれ、問題なければ service.registerStockItem が実行される（DB に追加される）
    - ブラウザは "redirect:{STOCK_LIST_URL}" にリダイレクトされる
    - リスト画面に戻った際、フラッシュメッセージ（success.register）が表示される
    - 一覧に新しい在庫レコードが存在することを確認
  - 優先度: 高

----------------------------
更新（GET / PATCH）関連
- TC-09: 更新画面 (GET) の表示とフォーム初期化
  - 目的: 指定 stockId のデータがフォームに正しくマッピングされること
  - 前提: 更新対象の StockItem が DB に存在する（例: stockId=5）
  - 手順:
    1. {STOCK_LIST_UPDATE_URL}/{stockId} にアクセス（例: /stock/update/5）
  - 期待結果:
    - 取得した StockItem の各フィールドがフォームに初期表示されている
      - stockId, categoryId, partName, centerId, description, quantity, deleteFlag 等
    - 「カテゴリ」「拠点」ドロップダウンが表示され、正しい選択値になっている
  - 優先度: 中

- TC-10: 更新（PATCH） - バリデーションエラー
  - 目的: 更新時の入力エラーは更新画面へリダイレクトされ、エラーメッセージが表示されること
  - 手順:
    1. 更新フォームで不正な値（例: partName を空）を入力して送信（PATCH）
  - 期待結果:
    - ブラウザは "redirect:{STOCK_LIST_UPDATE_URL}/{stockId}" にリダイレクトされる
    - リダイレクト後、フラッシュに ERROR_MSG があり、画面にエラーメッセージが表示される
    - DB の該当レコードは更新されていない
  - 優先度: 高

- TC-11: 更新（PATCH） - 正常更新
  - 目的: 正常な入力で在庫情報が更新されること
  - 手順:
    1. 更新フォームに正しい値を入力して送信（PATCH）
  - 期待結果:
    - service.updateStockItem が呼ばれ DB の該当レコードが更新される
    - ブラウザは "redirect:{STOCK_LIST_URL}" にリダイレクトされる
    - リスト画面に戻った際、フラッシュメッセージ（success.update）が表示される
    - 一覧の該当行の内容が更新されている
  - 優先度: 高

----------------------------
エラー・例外系
- TC-12: サービス例外発生時の挙動
  - 目的: 下位層（Service）が例外を投げた場合の画面の応答を確認する
  - 前提: 検査用に Service が例外を返す状態を作る（検査環境でモックするか DB を不正にする）
  - 手順:
    1. {STOCK_LIST_URL} にアクセス（Service が例外を投げる）
  - 期待結果:
    - サーバは 5xx エラーを返す（またはグローバルエラーページへ遷移。プロジェクトのエラーハンドリング方針に依る）
    - ユーザ向けに適切なエラーメッセージまたはエラーページが表示される
  - 優先度: 中

----------------------------
境界値・追加チェック（推奨）
- TC-13: quantity に 0 / 負値 / 大きすぎる値 を入力したときの挙動を確認
- TC-14: 長い文字列（例: 255 文字超）を partName に入力した場合のバリデーション
- TC-15: 同一名称を連続登録して重複チェックが働くか確認（競合ケース）

----------------------------
チェックリスト（テスト結果記録用）
- 実行者:
- 実行日:
- ブラウザ（バージョン）:
- 環境（URL/データベース）:
- テストID / 結果（PASS / FAIL） / 備考（スクリーンショットの保存場所・ログの参照先）

----------------------------
テストデータ（サンプル）
- 既存在庫例:
  - StockItem{id:1, partName:"DroneA", category:{id:1, name:"Quadcopter"}, center:{id:1, name:"Tokyo"}, amount:50, description:""}
  - StockItem{id:2, partName:"BatteryX", category:{id:2, name:"Battery"}, center:{id:2, name:"Osaka"}, amount:0, description:"low stock"}
- 登録用例:
  - partName: "NewSensor", categoryId:1, centerId:1, quantity:10, description:"for test"

----------------------------
備考（検査時の注意点）
- リダイレクト後のフラッシュメッセージは一度しか表示されないため、リダイレクトの追跡（ブラウザの devtools で location の遷移を確認）を忘れないこと
- バリデーション関連はフォームに設定されたアノテーションに依存するため、期待されるエラーメッセージは実装のメッセージ定義（messages.properties 等）に合わせて確認する
- 画面表示要素（テーブル列名、ボタンラベル）は UI 側の実装に依存するため、仕様書の文言は実画面に合わせて読み替えてください
- ログ出力を確認する場合はアプリケーションログ（コンソールまたはログファイル）で logStart / logEnd / logValidationError のメッセージを参照してください

作成者: ChatGPT（提供コード: StockListController.java の解析に基づく）
```